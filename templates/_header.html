<header>
    <h1 data-i18n="title">ğŸ— Sistema de Pedidos - RotiserÃ­a</h1>
    <nav class="header-actions" role="navigation" aria-label="Main navigation">
        <a href="/" class="btn btn-secondary" data-i18n="menu">ğŸ›’ MenÃº</a>
        <a href="/pedidos" class="btn btn-secondary" data-i18n="pedidos">ğŸ“‹ Pedidos</a>
        <a href="/analytics" class="btn btn-secondary" data-i18n="analytics">ğŸ“Š AnÃ¡lisis</a>
        <a href="/drivers" class="btn btn-secondary" data-i18n="drivers">ğŸ›µ Repartidores</a>
        <a href="/deliveries" class="btn btn-secondary" data-i18n="deliveries">ğŸšš Entregas</a>
        <button class="btn btn-secondary" onclick="toggleLanguage()" id="langBtn" data-i18n="langBtn">ğŸŒ EN</button>
        
        {% if is_index %}
        <button class="btn btn-secondary" onclick="showHistory()" data-i18n="history">ğŸ“‹ Historial</button>
        <button id="clearAllBtn" class="btn btn-danger" onclick="clearAllOrders()" data-i18n="clearAll">ğŸ—‘ï¸ Borrar Pedidos</button>
        <label style="display:flex;align-items:center;gap:.5rem;margin-left:.5rem;color:var(--fg-muted);font-size:0.9rem">Escala
            <input id="tileScale" type="range" min="0.6" max="1.8" step="0.1" value="1" style="width:140px">
        </label>
        {% endif %}
    </nav>
</header>
<script>
    const translations = {
        es: {
            menu: "ğŸ›’ MenÃº",
            pedidos: "ğŸ“‹ Pedidos",
            analytics: "ğŸ“Š AnÃ¡lisis",
            drivers: "ğŸ›µ Repartidores",
            deliveries: "ğŸšš Entregas",
            langBtn: "ğŸŒ EN",
            title: "ğŸ— Sistema de Pedidos - RotiserÃ­a",
            history: "ğŸ“‹ Historial",
            clearAll: "ğŸ—‘ï¸ Borrar Pedidos",
            orderTitle: "Tu Pedido",
            total: "Total",
            customer: "Cliente",
            notes: "Notas",
            placeOrder: "Realizar Pedido",
            clear: "Limpiar",
            readyTitle: "ğŸšš Pedidos Listos para Entrega",
            noReadyOrders: "No hay pedidos listos",
            selectDriver: "-- Seleccionar Repartidor --",
            assign: "Asignar",
            selectAll: "Seleccionar Todos",
            ready: "âœ” Listo",
            selectDriverToast: "Selecciona un repartidor",
            selectOrderToast: "Selecciona al menos un pedido",
            assignedToast: "pedidos asignados a",
            completedToast: "Pedido completado",
            unassignedToast: "AsignaciÃ³n removida",
            complete: "Completar",
            unassign: "Desasignar",
            unassigned: "(sin asignar)"
            ,
            
        },
        en: {
            menu: "ğŸ›’ Menu",
            pedidos: "ğŸ“‹ Orders",
            analytics: "ğŸ“Š Analytics",
            drivers: "ğŸ›µ Drivers",
            deliveries: "ğŸšš Deliveries",
            langBtn: "ğŸŒ ES",
            title: "ğŸ— Order System - Delicatessen",
            history: "ğŸ“‹ History",
            clearAll: "ğŸ—‘ï¸ Clear Orders",
            orderTitle: "Your Order",
            total: "Total",
            customer: "Customer",
            notes: "Notes",
            placeOrder: "Place Order",
            clear: "Clear",
            readyTitle: "ğŸšš Orders Ready for Delivery",
            noReadyOrders: "No orders ready",
            selectDriver: "-- Select Driver --",
            assign: "Assign",
            selectAll: "Select All",
            ready: "âœ” Ready",
            selectDriverToast: "Select a driver",
            selectOrderToast: "Select at least one order",
            assignedToast: "orders assigned to",
            completedToast: "Order completed",
            unassignedToast: "Assignment removed",
            complete: "Complete",
            unassign: "Unassign",
            unassigned: "(unassigned)"
            ,
            
        }
    };
    

    let currentLang = localStorage.getItem('lang') || 'es';

    function toggleLanguage() {
        currentLang = currentLang === 'es' ? 'en' : 'es';
        localStorage.setItem('lang', currentLang);
        applyLanguage();
    }

    function applyLanguage() {
        // Elements with data-i18n will be updated from translations
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            const text = translations[currentLang] && translations[currentLang][key];
            if (!text) return;
            el.textContent = text;
        });

        // Update page-specific elements only if they exist
        const mapping = {
            orderTitle: 'orderTitle',
            totalLabel: 'total',
            customerLabel: 'customer',
            notesLabel: 'notes',
            placeOrderBtn: 'placeOrder',
            clearBtn: 'clear',
            readyTitle: 'readyTitle'
        };
        Object.keys(mapping).forEach(id => {
            const el = document.getElementById(id);
            const key = mapping[id];
            if (el && translations[currentLang] && translations[currentLang][key]) el.textContent = translations[currentLang][key];
        });

        // Update driver select placeholder if present
        const bulkDriverSelect = document.getElementById('bulkDriverSelect');
        if (bulkDriverSelect && bulkDriverSelect.options[0]) bulkDriverSelect.options[0].text = translations[currentLang].selectDriver || bulkDriverSelect.options[0].text;

        // address placeholder handling removed

        if (typeof loadReadyOrders === 'function') loadReadyOrders();
    }

    

    // Tile scale helpers
    const TILE_BASE_PX = 130; // default base tile width used in CSS

    function setTileScale(scale) {
        const px = Math.round(TILE_BASE_PX * Number(scale));
        document.documentElement.style.setProperty('--menu-tile-min', px + 'px');
    }

    function initTileScale() {
        const slider = document.getElementById('tileScale');
        if (!slider) return;
        // restore saved scale or use slider default
        const saved = localStorage.getItem('tileScale');
        if (saved) {
            slider.value = saved;
            setTileScale(saved);
        } else {
            setTileScale(slider.value);
        }

        slider.addEventListener('input', (e) => {
            const v = e.target.value;
            setTileScale(v);
        });

        slider.addEventListener('change', (e) => {
            localStorage.setItem('tileScale', e.target.value);
        });
    }

    // Apply language and tile scale on load
    window.addEventListener('DOMContentLoaded', () => {
        applyLanguage();
        initTileScale();
    });

    function escapeHtml(text) {
        if (text == null) return '';
        const d = document.createElement('div');
        d.textContent = text;
        return d.innerHTML;
    }
</script>
